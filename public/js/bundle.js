(()=>{document.addEventListener("DOMContentLoaded",async function(){let g=document.getElementById("darkModeToggle"),c=document.getElementById("theme-toggle-dark-icon"),r=document.getElementById("theme-toggle-light-icon"),f=e=>{e?(document.documentElement.classList.add("dark"),c&&c.classList.remove("hidden"),r&&r.classList.add("hidden")):(document.documentElement.classList.remove("dark"),c&&c.classList.add("hidden"),r&&r.classList.remove("hidden"))},d=localStorage.getItem("darkMode")?JSON.parse(localStorage.getItem("darkMode")):window.matchMedia("(prefers-color-scheme: dark)").matches;f(d),g&&g.addEventListener("click",()=>{d=!d,localStorage.setItem("darkMode",JSON.stringify(d)),f(d)});let t=document.getElementById("toast");window.showToast=function(e,i="success"){t&&(t.textContent=e,t.classList.remove("bg-green-500","bg-red-500","opacity-0","translate-y-full"),t.style.visibility="visible",i==="error"?t.classList.add("bg-red-500"):t.classList.add("bg-green-500"),t.classList.add("opacity-100","translate-y-0"),setTimeout(()=>{t.classList.remove("opacity-100","translate-y-0"),t.classList.add("opacity-0","translate-y-full"),setTimeout(()=>{t.style.visibility="hidden"},500)},3e3))};let s=document.getElementById("cart-count-badge");window.updateCartCount=async function(){if(s)try{if((await(await fetch("/api/auth/status")).json()).isLoggedIn){let m=await fetch("/api/cart");if(m.ok){let B=(await m.json()).reduce((b,M)=>b+M.quantity,0);B>0?(s.textContent=B,s.style.display="flex"):s.style.display="none"}else m.status===401||console.error("Failed to fetch cart for count:",m.status),s.style.display="none"}else s.style.display="none"}catch(e){console.error("Error updating cart count:",e),s&&(s.style.display="none")}};let h=document.getElementById("currentYear");h&&(h.textContent=new Date().getFullYear());let y=document.getElementById("mobileMenuButton"),l=document.getElementById("mobileMenu");y&&l&&(y.addEventListener("click",()=>{l.classList.toggle("hidden")}),document.addEventListener("click",e=>{!l.contains(e.target)&&!y.contains(e.target)&&!l.classList.contains("hidden")&&l.classList.add("hidden")}));let p=document.getElementById("category-nav"),L=document.getElementById("main-header");if(p&&L){let e=L.offsetHeight;p.style.top=`${e}px`}let v=document.getElementById("auth-container"),o=document.getElementById("login-link"),a=document.getElementById("register-link"),n=document.getElementById("user-info"),E=document.getElementById("username-display"),u=document.getElementById("logout-button"),I=n?n.querySelector('a[href="account.html"]'):null;async function k(){if(v)try{let e=await fetch("/api/auth/status");if(!e.ok){console.error("Failed to fetch auth status:",e.status),o&&(o.style.display="inline"),a&&(a.style.display="inline"),n&&n.classList.add("hidden");return}let i=await e.json();i.isLoggedIn?(o&&(o.style.display="none"),a&&(a.style.display="none"),n&&(n.classList.remove("hidden"),E&&(E.textContent=i.username||"User"),I&&(I.style.display="inline")),u&&(u.style.display="inline",u.removeEventListener("click",w),u.addEventListener("click",w))):(o&&(o.style.display="inline"),a&&(a.style.display="inline"),n&&n.classList.add("hidden"))}catch(e){console.error("Error updating auth UI:",e),o&&(o.style.display="inline"),a&&(a.style.display="inline"),n&&n.classList.add("hidden")}}async function w(){try{let e=await fetch("/api/auth/logout",{method:"POST"}),i=await e.json();e.ok?showToast(i.message||"\u0110\u0103ng xu\u1EA5t th\xE0nh c\xF4ng!","success"):showToast(i.message||"\u0110\u0103ng xu\u1EA5t th\u1EA5t b\u1EA1i.","error")}catch(e){console.error("Error logging out:",e),showToast("L\u1ED7i khi \u0111\u0103ng xu\u1EA5t.","error")}k()}await k(),updateCartCount()});})();
//# sourceMappingURL=bundle.js.map
